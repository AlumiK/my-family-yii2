<?php

use yii\db\Migration;

class m190211_171945_create_other_name_db extends Migration
{
    /**
     * {@inheritdoc}
     */
    public function safeUp()
    {
        $this->createTable('name_out', [
            'id' => $this->primaryKey(),
            'generation' => $this->integer()->notNull(),
            'gender' => $this->integer()->notNull(),
            'name' => $this->string(255)->notNull(),
        ]);

        $this->addForeignKey(
            'name_out_gender_id_fk',
            'name_out',
            'gender',
            'gender',
            'id'
        );

        $this->batchInsert('name_out',
            ['id', 'generation', 'gender', 'name'],
            [
                [1, 0, 1, '哥哥/弟弟'],
                [2, 0, 2, '姐姐/妹妹'],
                [3, -1, 1, '叔叔'],
                [4, -1, 2, '阿姨'],
                [5, -2, 1, '爷爷'],
                [6, -2, 2, '婆婆'],
            ]
        );

        $this->createTable('name_node', [
            'id' => $this->primaryKey(),
            'name' => $this->string(255)->notNull(),
            'gender' => $this->integer()->notNull(),
        ]);

        $this->addForeignKey(
            'name_node_gender_id_fk',
            'name_node',
            'gender',
            'gender',
            'id'
        );

        $this->batchInsert(
            'name_node',
            ['id', 'name', 'gender'],
            [
                [1, '本人', 1],
                [2, '爸爸', 2],
                [3, '妈妈', 3],
                [4, '爷爷', 2],
                [5, '婆婆', 3],
                [6, '%mandatory%爸', 2],
                [7, '%conjugal_mandatory%妈', 3],
                [8, '%optional%堂兄弟', 2],
                [9, '%mandatory%爷', 2],
                [10, '%optional%姑婆', 3],
                [11, '祖父', 2],
                [12, '祖母', 3],
                [13, '兄弟', 2],
                [14, '姐妹', 3],
                [15, '丈夫', 2],
                [16, '妻子', 3],
                [17, '%optional%儿子', 2],
                [18, '%optional%女儿', 3],
                [19, '%conjugal_optional%儿媳妇', 3],
                [20, '%conjugal_optional%女婿', 2],
                [21, '%conjugal_optional%姑公', 2],
                [22, '%conjugal_mandatory%婆', 3],
                [23, '%optional%表叔', 2],
                [24, '%optional%表姑', 3],
                [25, '%optional%堂叔', 2],
                [26, '%optional%堂姑', 3],
            ]
        );

        $this->createTable('name_graph', [
            'id' => $this->primaryKey(),
            'node' => $this->integer()->notNull(),
            'related_node' => $this->integer()->notNull(),
            'type' => $this->integer()->notNull(),
        ]);

        $this->addForeignKey(
            'name_graph_name_node_id_fk',
            'name_graph',
            'node',
            'name_node',
            'id'
        );

        $this->addForeignKey(
            'name_graph_name_node_id_fk_2',
            'name_graph',
            'related_node',
            'name_node',
            'id'
        );

        $this->addForeignKey(
            'name_graph_name_type_id_fk',
            'name_graph',
            'type',
            'name_type',
            'id'
        );

        $this->createIndex(
            'name_graph_uk',
            'name_graph',
            ['node', 'type'],
            true
        );

        $this->createIndex(
            'name_graph_uk_2',
            'name_graph',
            ['node', 'related_node'],
            true
        );

        $this->batchInsert(
            'name_graph',
            ['id', 'node', 'related_node', 'type'],
            [
                [1, 1, 2, 1],
                [2, 2, 13, 5],
                [3, 1, 3, 2],
                [4, 3, 13, 5],
                [5, 2, 3, 8],
                [6, 3, 2, 7],
                [7, 2, 4, 1],
                [8, 4, 6, 5],
                [9, 2, 5, 2],
                [10, 5, 6, 5],
                [11, 4, 5, 8],
                [12, 5, 4, 7],
                [13, 2, 6, 3],
                [14, 6, 6, 3],
                [15, 6, 7, 8],
                [16, 7, 6, 7],
                [17, 7, 8, 5],
                [18, 8, 7, 2],
                [19, 6, 8, 5],
                [20, 8, 6, 1],
                [21, 4, 11, 1],
                [22, 11, 9, 5],
                [23, 4, 12, 2],
                [24, 12, 9, 5],
                [25, 11, 12, 8],
                [26, 12, 11, 7],
                [27, 4, 9, 3],
                [28, 4, 10, 4],
                [29, 9, 9, 3],
                [30, 10, 10, 4],
                [31, 9, 10, 4],
                [32, 10, 9, 3],
                [33, 10, 11, 1],
                [34, 10, 12, 2],
                [35, 11, 10, 6],
                [36, 12, 10, 6],
                [37, 14, 2, 1],
                [38, 14, 3, 2],
                [39, 2, 14, 6],
                [40, 3, 14, 6],
                [41, 1, 13, 3],
                [42, 13, 13, 3],
                [43, 1, 14, 4],
                [44, 13, 14, 4],
                [45, 14, 13, 3],
                [46, 6, 4, 1],
                [47, 6, 5, 2],
                [48, 13, 2, 1],
                [49, 13, 3, 2],
                [50, 9, 11, 1],
                [51, 9, 12, 2],
                [52, 14, 14, 4],
                [53, 1, 15, 7],
                [54, 15, 1, 8],
                [55, 1, 16, 8],
                [56, 16, 1, 7],
                [57, 1, 17, 5],
                [58, 17, 1, 1],
                [59, 16, 17, 5],
                [60, 17, 16, 2],
                [61, 15, 17, 5],
                [62, 17, 17, 3],
                [63, 17, 18, 4],
                [64, 18, 17, 3],
                [65, 18, 18, 4],
                [66, 1, 18, 6],
                [67, 18, 1, 1],
                [68, 16, 18, 6],
                [69, 18, 16, 2],
                [70, 15, 18, 6],
                [71, 17, 19, 8],
                [72, 19, 17, 7],
                [73, 18, 20, 7],
                [74, 20, 18, 8],
                [75, 10, 21, 7],
                [76, 21, 10, 8],
                [77, 9, 22, 8],
                [78, 22, 9, 7],
                [79, 21, 23, 5],
                [80, 23, 21, 1],
                [81, 21, 24, 6],
                [82, 24, 21, 1],
                [83, 10, 23, 5],
                [84, 10, 24, 6],
                [85, 23, 10, 2],
                [86, 24, 10, 6],
                [87, 23, 23, 3],
                [88, 24, 24, 4],
                [89, 23, 24, 4],
                [90, 24, 23, 3],
                [91, 9, 25, 5],
                [92, 9, 26, 6],
                [93, 25, 9, 1],
                [94, 26, 9, 1],
                [95, 22, 25, 5],
                [96, 22, 26, 6],
                [97, 25, 22, 2],
                [98, 26, 22, 2],
                [99, 25, 25, 3],
                [100, 26, 26, 4],
                [101, 25, 26, 4],
                [102, 26, 25, 3],
//                [103,],
//                [104,],
//                [105,],
//                [106,],
//                [107,],
//                [108,],
//                [109,],
//                [110,],
//                [111,],
//                [112,],
//                [113,],
//                [114,],
//                [115,],
//                [116,],
//                [117,],
//                [118,],
//                [119,],
//                [120,],
//                [121,],
//                [122,],
//                [123,],
//                [124,],
//                [125,],
//                [126,],
//                [127,],
//                [128,],
//                [129,],
//                [130,],
//                [131,],
//                [132,],
//                [133,],
//                [134,],
//                [135,],
//                [136,],
//                [137,],
//                [138,],
//                [139,],
//                [140,],
//                [141,],
//                [142,],
//                [143,],
//                [144,],
//                [145,],
//                [146,],
//                [147,],
//                [148,],
//                [149,],
//                [150,],
//                [151,],
//                [152,],
//                [153,],
//                [154,],
//                [155,],
//                [156,],
//                [157,],
//                [158,],
//                [159,],
//                [160,],
//                [161,],
//                [162,],
//                [163,],
//                [164,],
//                [165,],
//                [166,],
//                [167,],
//                [168,],
//                [169,],
//                [170,],
//                [171,],
//                [172,],
//                [173,],
//                [174,],
//                [175,],
//                [176,],
//                [177,],
//                [178,],
//                [179,],
//                [180,],
//                [181,],
//                [182,],
//                [183,],
//                [184,],
//                [185,],
//                [186,],
//                [187,],
//                [188,],
//                [189,],
//                [190,],
//                [191,],
//                [192,],
//                [193,],
//                [194,],
//                [195,],
//                [196,],
//                [197,],
//                [198,],
//                [199,],
            ]
        );
    }

    /**
     * {@inheritdoc}
     */
    public function safeDown()
    {
        $this->dropTable('name_graph');

        $this->dropTable('name_node');

        $this->dropTable('name_out');
    }
}
